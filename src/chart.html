<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Serial Stream Chart</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #0d1117;
    color: #c9d1d9;
    height: 100%;
    width: 100%;
	  overflow: hidden;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }

  #chart {
    height: 100%;
    width: 100%;
  }
</style>
</head>
<body>

<div id="chart"></div>

<script type="module">
  import ApexCharts from 'apexcharts'
  import { listen } from '@tauri-apps/api/event'

  const MAX_POINTS = 500

  const seriesData = []

  const options = {
    chart: {
      type: 'line',
      height: '100%',
      width: '100%',
      animations: {
        enabled: true,
        easing: 'linear',
        speed: 150
      },
      background: 'transparent',
	  parentHeightOffset: 0, 
      toolbar: { show: false },
      zoom: { enabled: false }
    },

    theme: {
      mode: 'dark'
    },

    stroke: {
      curve: 'smooth',
      width: 2
    },

    grid: {
      borderColor: '#1f2937',
      strokeDashArray: 3
    },

    xaxis: {
      type: 'datetime',
      labels: {
        style: { colors: '#8b949e' }
      }
    },

    yaxis: {
      decimalsInFloat: 2,
      labels: {
        style: { colors: '#8b949e' }
      }
    },

    tooltip: {
      theme: 'dark',
      x: { format: 'HH:mm:ss' }
    },

    series: [{
      name: 'Value',
      data: seriesData
    }]
  }

  const chart = new ApexCharts(document.querySelector('#chart'), options)
  chart.render()

  // --- SERIAL DATA HOOK ---
  await listen('serial_rx', (event) => {
    const v = event.payload

    // adapt this if payload is structured
    const y = typeof v === 'number' ? v : v.value
    const x = Date.now()

    seriesData.push([x, y])
    if (seriesData.length > MAX_POINTS) {
      seriesData.shift()
    }

    chart.updateSeries([{
      data: seriesData
    }], false)
  })
</script>

</body>
</html>
